<!DOCTYPE html>
<meta charset="utf-8">
<style>
#boroughs {
  stroke: #A5D6A7;
  stroke-width: 1px;
  fill: #2c3e50;
}

svg{
  background-color: #2980b9;
}

</style>
<body>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <div id = "map" style = "float : left; min-width:320px;width :50%;height : 600px;"></div>
  <script>

  var width = 900,
  height = 800;

  var projection = d3.geo.mercator()
  .center([-73.97, 40.76])
  // .scale(80000)
  // .translate([(width/2), (height/2)]);

  var svg = d3.select("#map").append("svg")
  .attr("viewBox", "0 0 900 800")
  .attr("preserveAspectRatio", "xMidYMid meet");

  var path = d3.geo.path()
  .projection(projection);

  var g = svg.append("g");

  d3.json("nycopy.json", function(error, ny) {

    var b = [ projection([ny.bbox[0],ny.bbox[3]]),projection([ny.bbox[2],ny.bbox[1]]) ];
        var s = 25 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
    	projection.scale(s);

    g.append("path")
    .attr("id", "boroughs")
    .datum(topojson.feature(ny, ny.objects.boroughs))
    .attr("d", path);



var data = $.ajax({
   type: 'GET',
   accept: '*/*',
   url:'https://member.citibikenyc.com/data/stations.json',
   dataType: 'JSON',
   crossDomain: true,
   success:function(){ parseStationJson(data)},
   error:function(){alert("Error:")}
});

var stationsArray = [];

function parseStationJson (data){
  $.each(JSON.parse(data.responseText), function() {
    $.each(this, function(){
      //inside stations
      if(this.d != "JC District"){
        var stationObject = {id:this.id, station:this.s, coordInfo:[this.lo, this.la, this.id], blocked:this.b, availBikes:this.ba, availDocks:this.da};
        stationsArray.push(stationObject);
      }
    })

  })
  createCoordinateArray(stationsArray);
}

var coordinateArray = [];

function createCoordinateArray (stationsArray) {
  for (var i = 0, l = stationsArray.length; i < l; i++) {
    coordinateArray.push(stationsArray[i].coordInfo);

  }
plotStations(coordinateArray);
}

function plotStations (stationsArray){
    g.selectAll("circle")
    .data(coordinateArray).enter()
    .append("circle")
    .attr("cx", function (d) {  return projection(d) [0];})
    .attr("cy", function (d) { return projection(d) [1];})
    .attr("id", function (d) { return d[2];})
    .attr("r", "5px")
    .attr("fill", "#e74c3c")
    .attr("cursor", "pointer")

.on("mouseover", function(d,i) {
    d3.select(this).transition()
        .ease("elastic")
        .duration("500")
        .attr("r", 35);
    d3.select("#clipCircle"+i+" circle").transition()
        .ease("cubic-out")
        .duration("200")
        .attr("r", 32);
    d3.select("#text"+i).transition()
        .ease("cubic-out")
        .duration("200")
        .attr("y", 2)
        .attr("font-size", 32)
        .attr("fill", "#333");
})
.on("mouseout", function(d,i) {
    d3.select(this).transition()
        .ease("quad")
        .delay("100")
        .duration("200")
        .attr("r", 5);
    d3.select("#clipCircle"+i+" circle").transition()
        .ease("quad")
        .delay("100")
        .duration("200")
        .attr("r", 0);
    d3.select("#text"+i).transition()
        .ease("cubic-out")
        .duration("400")
        .delay("100")
        .attr("y", 7)
        .attr("font-size", 20)
        .attr("fill", "#FFF");;
} );
}

// zoom and pan
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("path")
            .attr("d", path.projection(projection));
  });

svg.call(zoom)

  });


  </script>
</body>
</html>
