<!DOCTYPE html>
<meta charset="utf-8">
<style>

/* CSS goes here. */

#boroughs {
  stroke: grey;
  stroke-width: 1px;
  fill: white;
}

</style>
<body>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>


      <div id = "map" style = "float : left; min-width:320px;width :50%;height : 600px">
      </div>


  <script>

  var width = 900,
  height = 800;

  var projection = d3.geo.mercator()
  .center([-73.94, 40.70])
  .scale(75000)
  .translate([(width) / 2, (height)/2]);

  var path = d3.geo.path()
  .projection(projection);

  var svg = d3.select("#map").append("svg")
  .attr("viewBox", "0 0 900 800")
  .attr("preserveAspectRatio", "xMidYMid meet");


  d3.json("ny.json", function(error, ny) {
    svg.append("path")
    .attr("id", "boroughs")
    .datum(topojson.feature(ny, ny.objects.boroughs))
    .attr("d", path);


var zoom = d3.behavior.zoom()
    .translate(projection.translate())
    .scale(projection.scale())
    .scaleExtent([height, 8 * height])
    .on("zoom", zoomed);

var data = $.ajax({
   type: 'GET',
   accept: '*/*',
   url:'https://member.citibikenyc.com/data/stations.json',
   dataType: 'JSON',
   crossDomain: true,
   success:function(){ parseStationJson(data)},
   error:function(){alert("Error:")}
});

var stationsArray = [];



function parseStationJson (data){
  $.each(JSON.parse(data.responseText), function() {
    $.each(this, function(){
      //inside stations
      if(this.d != "JC District"){
        var stationObject = {id:this.id, station:this.s, coordInfo:[this.lo, this.la, this.id], blocked:this.b, availBikes:this.ba, availDocks:this.da};
        stationsArray.push(stationObject);
      }
    })

  })
  createCoordinateArray(stationsArray);
}

var coordinateArray = [];

function createCoordinateArray (stationsArray) {
  for (var i = 0, l = stationsArray.length; i < l; i++) {
    coordinateArray.push(stationsArray[i].coordInfo);

  }
plotStations(coordinateArray);
}

function plotStations (stationsArray){
    svg.selectAll("circle")
    .data(coordinateArray).enter()
    .append("circle")
    .attr("cx", function (d) {  return projection(d) [0];})
    .attr("cy", function (d) { return projection(d) [1];})
    .attr("id", function (d) { return d[2];})
    .attr("r", "2px")
    .attr("fill", "red")
}


//create a for each loop to assign all the ponits to a dot :

    // add circles to svg
// svg.selectAll("circle")
// .data([aa,bb]).enter()
// .append("circle")
// .attr("cx", function (d) { console.log(projection(d)); return projection(d)[0]; })
// .attr("cy", function (d) { return projection(d)[1]; })
// .attr("r", "3px")
// .attr("fill", "red")
  });

  </script>
</body>
</html>
